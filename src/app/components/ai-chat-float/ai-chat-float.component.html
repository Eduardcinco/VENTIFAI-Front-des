<!-- BotÃ³n flotante inferior derecha -->
<button 
  class="ai-float-button" 
  (click)="toggleChat()"
  [class.active]="isOpen()"
  title="Â¿Pregunta rÃ¡pida?">
  <svg *ngIf="!isOpen()" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    <circle cx="9" cy="10" r="1"></circle>
    <circle cx="15" cy="10" r="1"></circle>
    <path d="M9 14c.5.5 1.5 1 3 1s2.5-.5 3-1"></path>
  </svg>
  <svg *ngIf="isOpen()" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>
</button>

<!-- Panel de chat -->
<div class="ai-chat-panel" [class.open]="isOpen()">
  <div class="ai-chat-header">
    <div class="ai-chat-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 8V4H8"></path>
        <rect width="16" height="12" x="4" y="8" rx="2"></rect>
        <path d="M2 14h2"></path>
        <path d="M20 14h2"></path>
        <path d="M15 13v2"></path>
        <path d="M9 13v2"></path>
      </svg>
      <span>Asistente Ventify</span>
    </div>
    <button class="ai-chat-clear" (click)="limpiarChat()" title="Limpiar chat">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 6h18"></path>
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
      </svg>
    </button>
  </div>

  <div class="ai-chat-messages">
    @if (!isAuthenticated()) {
      <div class="ai-chat-info">
        ðŸ”’ Inicia sesiÃ³n para usar el asistente.
      </div>
    }
    @for (msg of messages(); track $index) {
      <div class="ai-message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
        <div class="ai-message-avatar">
          @if (msg.role === 'user') {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect width="16" height="12" x="4" y="8" rx="2"></rect>
              <path d="M9 13v2"></path>
              <path d="M15 13v2"></path>
            </svg>
          }
        </div>
        <div class="ai-message-content">{{ msg.content }}</div>
      </div>
    }

    @if (loading()) {
      <div class="ai-message assistant">
        <div class="ai-message-avatar">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect width="16" height="12" x="4" y="8" rx="2"></rect>
          </svg>
        </div>
        <div class="ai-message-content">
          <div class="ai-typing">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    }
  </div>

  @if (error()) {
    <div class="ai-chat-error">
      {{ error() }}
    </div>
  }

  <div class="ai-chat-input">
    <textarea
      [(ngModel)]="currentQuestion"
      placeholder="Pregunta sobre Ventify..."
      rows="2"
      (keypress)="handleKeyPress($event)"
      [disabled]="loading() || !isAuthenticated()"></textarea>
    <button 
      class="ai-send-button" 
      (click)="enviarPregunta()" 
      [disabled]="!currentQuestion().trim() || loading() || !isAuthenticated()"
      title="Enviar (Enter)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="22" x2="11" y1="2" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    </button>
  </div>
</div>
